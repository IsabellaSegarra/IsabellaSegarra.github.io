{
  "hash": "b9d48aefd1159a807f09e1772574ca6a",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Investigating Blue Carbon with Beta Regression\"\ndescription: \"A brief statistical analysis of soil carbon.\"\ndate: 2025-12-4\ncategories: [MEDS, R, data-viz] #add hyphen for multiple words\nimage: image.png\ncitation: # true if no link \n  url: https://isabellasegarra.github.io/posts/2025-12-04-eds222-blog\ndraft: false\ndraft-mode: linked\nbibliography: references.bib\n---\n\n# Investigating Blue Carbon with Beta Regression\n\n## Research Question\n\nCoastal and marine ecosystems have the unique capacity to store carbon in the soil rather than vegetation like terrestrial ecosystems. This is often referred to as blue carbon, and is of growing interest as carbon dioxide continues to accumulate in the atmosphere. Understanding the biogeochemical processes that make up blue carbon is important for advancing blue carbon management as a solution to climate change (@USGS_BlueCarbon_2024).\n\nFor this project, I will fit a **Beta Regression** model to answer the following question:\n\n-   How does soil organic matter affect carbon?\n-   Do some habitats (marsh, wetland, mangrove) have systematically more carbon than others?\n\n## Data Background\n\nThis data is from the Smithsonian Environmental Research Center Coastal Carbon Network (@ERC_CoastalCarbon). The CCN collects and standardizes carbon stock and flux data from coastal ecosystems worldwide. They prove open-access to data sets for researchers and students like me. The dataset itself was originally over 15,000,000 observations. It includes data on soil measuremets such as depth of soil cores, soil bulk density, organic matter, carbon, and data on habitat and associated vegetation.\n\n## Data wrangling\n\nIn this section I filtered the data for only variables of interest (`fraction_carbon`, `fraction_organic_matter`, `max_depth`, `habitat`) as well as ensured that `fraction_carbon` only contained fractional data between 0 and 1. For this dataset, I also filtered to the three most researched habitats for blue carbon: mangrove, seagrass, and marsh.\n\n\n::: {.cell}\n\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Import 'CCN_sites', 'CCN_species', 'CCN_cores', 'CCN_depth_series'\n\nsites <- read_csv(here(\"posts/2025-12-04-eds222-blog/CCN_data/CCN_sites.csv\"))\nspecies <- read_csv(here(\"posts/2025-12-04-eds222-blog/CCN_data/CCN_species.csv\"))\ncores <- read_csv(here(\"posts/2025-12-04-eds222-blog/CCN_data/CCN_cores.csv\"))\ndepth_series <- read_csv(here(\"posts/2025-12-04-eds222-blog/CCN_data/CCN_depthseries.csv\"))\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# .....Further filter datasets.....\n\n# species data \nspecies <- species %>% \n  select('site_id', 'habitat') %>% \n  filter(habitat %in% c(\"mangrove\", \"seagrass\", \"marsh\")) %>% \n  drop_na()\n\n# cores data \ncores <- cores %>% \n  select('site_id', 'max_depth') %>% \n  drop_na()\n\n# depth series data \ndepth_series <- depth_series %>% \n  select('site_id','fraction_organic_matter', 'fraction_carbon') %>% \n  drop_na()\n\n#.....Join datasets.....\n\nblue_carbon <- species %>% \n  full_join(depth_series, by = c('site_id')) %>% \n  full_join(cores, by =  c('site_id')) \n\n\n#.....Remove Negative values from Fraction Carbon.....\n\n# Ensure `fraction_carbon` ranges between 0 and 1 for analysis.\nrange(blue_carbon$fraction_carbon)\n\nsum(blue_carbon$fraction_carbon < 0, na.rm = TRUE) # 467 negative values. \n\n# Replace negative numbers wiht NAs\nblue_carbon$fraction_carbon[blue_carbon$fraction_carbon < 0] <- NA\n\n# Check range to ensure negative values were \nrange(blue_carbon$fraction_carbon)\n\n# Remove Nas from entire dataset\nblue_carbon <- na.omit(blue_carbon)\n\n# clear up environment\nrm(list = c(\"cores\", \"depth_series\", \"sites\", \"species\"))\n```\n:::\n\n\n## Data Exploration\n\nIn order to understand what analysis needs to be done, some preliminary data exploration is useful.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfrac_car_plot <- blue_carbon %>% \n  ggplot(aes(fraction_carbon)) +\n  geom_histogram(fill = \"#345084FF\") +\n  labs(x = \"Fraction carbon\", \n       y = \"Frequency\", \n       title = \"Distribution of Fraction Carbon\") +\n  theme_classic()\n\nfrac_car_plot\n```\n\n::: {.cell-output-display}\n![](blue-carbon-beta-regression_files/figure-html/Data viz 1-1.png){width=672}\n:::\n:::\n\n\nAs you can see from the graph above, fraction carbon is left skewed signifying that it does not follow a normal distribution.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nblue_carbon %>% \n  ggplot(aes(x = fraction_organic_matter, y = fraction_carbon, color = habitat)) +\n  geom_point(alpha = 0.5) +\n  scale_color_paletteer_d(\"nationalparkcolors::Acadia\") +\n  theme_classic() +\n  labs(x = \"Soil Organic Matter (dimensionless)\", \n       y = \"Fraction carbon (dimensionless)\", \n       title = \"Relationship Between Soil Organic Matter and Fraction Carbon\")\n```\n\n::: {.cell-output-display}\n![](blue-carbon-beta-regression_files/figure-html/Data viz 2-1.png){width=672}\n:::\n:::\n\n\n## Statistical model: Beta Regression\n\nSince my response variable, `fraction_carbon` is a fraction between 0 and 1, and is not normally distributed around the mean, I will use *Beta regression* (@CribariNetoZeileis2010). Beta regression models the mean of a proportion or fraction as a function of predictors.\n\n### Hypothesis\n\nQuestion: How does soil organic matter affect carbon?\n\n-   H₀ (null hypothesis): Soil organic matter has no effect on fraction carbon in the soil.\n\n-   H₁ (alternative hypothesis): Higher soil organic matter is associated with higher fraction carbon.\n\nWhy include `max_depth`? Deeper soils might have more organic matter accumulation and fraction carbon can change with depth (e.g., shallower layers of soil may have higher carbon than deeper layers). This is measured in cm.\n\nI represented these casual relationships with a DAG (directed acyclic graph):\n\n![DAG](images/DAG-final-project.png)\n\n### Statistical Notation of model\n\n$$\n\\begin{align}\n\\text{carbon} &\\sim \\text{Beta}(\\mu, \\phi) \\\\\nlogit(\\mu) &= \\beta_0 + \\beta_1 \\, \\text{organicmatter}_i + \\beta_2 \\, \\text{maxdepth}_i\n\\end{align}\n$$\n\n-   *carbon* is the fraction of carbon, constrained between 0 and 1.\n-   $\\mu_i$ is the expected value of carbon.\n-   $\\phi$ is the precision parameter of the beta distribution. This controls the variance.\n-   coefficients: $\\beta_0$ is the intercept; $\\beta_1$ and $\\beta_2$ are coefficients for the predictors fraction organic matter and max depth\n\n## Fit model to simulated data\n\nIn order to determine if a Beta regression model is fit for this data, I will *simulate* data and perform an analysis on the simulated data. This includes the following steps:\n\n1.  define sample size\n2.  choose parameters for $\\beta$\n3.  define range for predictors: This step is not necessary but helpful in simulating real *fake* data.\n4.  define linear equation and logit function\n5.  generate response\n6.  fit model to simulated data\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# set seed for reproducibility\nset.seed(123)\n\n# 1. Define sample size\nn <- 1000 # large enough\n\n# 2. Choose parameters \nbeta_0 <- 0.5 # intercept (fraction carbon)\nbeta_1 <- 0.8  # effect of fraction organic matter\nbeta_2 <- -0.01 # effect of max_depth\nphi <- 0.8 # precision parameter \n\n# 3. define predictor ranges (x's)\n# (n=sample size, min, max)\nfraction_organic_matter <- runif(n, 0.05, 0.2)\nmax_depth <- runif(n, 0, 30)\n\n# 3. Linear predictor and Logit response\n  # set logit_mu \nlogit_mu <- beta_0 + beta_1 * fraction_organic_matter + beta_2 * max_depth \n  # set transformation \n\n  # Inverse logit \nmu <- 1 / (1 + exp(-logit_mu)) # mu = mean of beta distribution\n\n# 4. Generate response with rbeta(). Look up documentation\nshape1 <- mu * phi\nshape2 <- (1 - mu) * phi\nfraction_carbon <- rbeta(n, shape1, shape2)\n\n# 5. Create dataframe for simulated data\nsim_blue_carbon <- data.frame(fraction_carbon, fraction_organic_matter, max_depth)\n\n# 6. Fit model \nbetareg_sim_mdl <- glmmTMB(fraction_carbon ~ fraction_organic_matter + max_depth, data = sim_blue_carbon, family = beta_family())\n\n  # Summarize model\nsummary(betareg_sim_mdl)\n```\n:::\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<caption>Table 1. Model Assessment</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Coefficient </th>\n   <th style=\"text-align:right;\"> Simulation Estimate </th>\n   <th style=\"text-align:right;\"> Actual Parameter </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Intercept </td>\n   <td style=\"text-align:right;\"> 0.4436133 </td>\n   <td style=\"text-align:right;\"> 0.50 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Fraction Organic Matter </td>\n   <td style=\"text-align:right;\"> 1.9178514 </td>\n   <td style=\"text-align:right;\"> 0.80 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Max Depth(cm) </td>\n   <td style=\"text-align:right;\"> -0.0115171 </td>\n   <td style=\"text-align:right;\"> -0.01 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nThe model seems to recover parameters well. This is good evidence that beta regression is the model for this data.\n\n## Fit model to real-life data\n\nIn this section I will fit the model to real life data from the Smithsonian's Coastal Carbon Network. I will use the `glmmTMB` package and specify the family as `beta_family` for a beta regression.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# .....Fit beta regression model..... \n\nbetareg_mdl <- glmmTMB(fraction_carbon ~ fraction_organic_matter + max_depth, \n                      data = blue_carbon[1:10000, ], family = beta_family()) # subset data for faster processing \n\n\n# .....Summarize model.....\nbetareg_mdl_sum <- summary(betareg_mdl)\n\n# .....Extract coefficients..... \n\n# beta_0 (intercept)\nbeta_0 <- betareg_mdl_sum$coefficients$cond[\"(Intercept)\", \"Estimate\"] \n\n# beta_1 (slope of reference)\nbeta_1 <- betareg_mdl_sum$coefficients$cond[\"fraction_organic_matter\", \"Estimate\"]\n\n# beta_2 (change in intercepts)\nbeta_2 <- betareg_mdl_sum$coefficients$cond[\"max_depth\", \"Estimate\"]\n\n# Dispersion parameter\ndispersion <- sigma(betareg_mdl)\n```\n:::\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<caption>Table 2. Beta Regression Output</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Coefficient </th>\n   <th style=\"text-align:right;\"> Estimate </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Intercept </td>\n   <td style=\"text-align:right;\"> -5.4448087 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Fraction Organic Matter </td>\n   <td style=\"text-align:right;\"> 8.6053830 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Max Depth(cm) </td>\n   <td style=\"text-align:right;\"> 0.0277703 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n## Generate predictions\n\nIn this section I will generate predictions to visualize what the relationship will be for new data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# .....Create prediction grid.....\npred_grid <- expand_grid(fraction_organic_matter = seq(from = 0, to = 1, by = 0.001)) %>% \n  mutate(max_depth = mean(blue_carbon$max_depth, na.rm = TRUE))\n\n# ......Generate predictions.....\nbetareg_grid <- pred_grid %>% \n  mutate(predictions = predict(object = betareg_mdl, # glm\n                     newdata = pred_grid, # expand grid data\n                     type = \"response\")) # response link \n\n# .....Plot predictions.....\npredict_plot <- ggplot(betareg_grid, aes(fraction_organic_matter, y = predictions)) +\n  geom_line(col = \"#345084FF\" ) +\n  labs(x= \"Fraction Organic Matter (dimensionless)\", \n       y = \"Fraction Carbon (dimensionless)\", \n       title = \"Predicted Fraction Carbon\") +\n  theme_bw()\n\n# View plot\npredict_plot\n```\n\n::: {.cell-output-display}\n![](blue-carbon-beta-regression_files/figure-html/Generate predictions-1.png){width=672}\n:::\n:::\n\n\n## Conclusion and next steps\n\n## References\n\n## Github\n\n[Link to Github repository](https://github.com/IsabellaSegarra/coastal-carbon)\n",
    "supporting": [
      "blue-carbon-beta-regression_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}